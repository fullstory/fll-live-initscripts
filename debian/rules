#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk

common-build-indep::
	$(MAKE) -C man man

build/fll-live-xorgconfig::
	# RandR 1.2 device compat. lists
	gawk -f contrib/ati.awk contrib/src/atipciids.h \
		> share/fll-live-xorgconfig/xrandr/ati
	gawk -f contrib/nv.awk contrib/src/nv_driver.c \
		> share/fll-live-xorgconfig/xrandr/nv
	# fll_xserver_discover
	$(MAKE) -C bin fll_xserver_discover

install/fll-live-initscripts::
	# fll-{reboot,halt} are the same script. duplicate it
	cp debian/fll-live-initscripts.fll-reboot.init \
		debian/fll-live-initscripts.fll-halt.init
	
	# install and configure runlevel seq. for our initscripts
	dh_installinit --no-start --name=fll-init	-- start 00 S .
	dh_installinit --no-start --name=fll-locales	-- start 04 S .
	dh_installinit --no-start --name=fll-fstab	-- start 34 S .
	dh_installinit --no-start --name=fll-resume	-- start 34 S .
	dh_installinit --no-start --name=fll-network	-- start 34 S .
	dh_installinit --no-start --name=fll-hwsetup	-- start 80 S .
	dh_installinit --no-start --name=fll-cpufreq	-- start 80 S .
	dh_installinit --no-start --name=fll-shell	-- start 90 S .
	dh_installinit --no-start --name=fll-adduser	-- start 90 S .
	dh_installinit --no-start --name=fll-xdm	-- start 95 S .
	dh_installinit --no-start --name=fll-desktop	-- start 95 S .
	
	# halt|reboot replacements
	dh_installinit --no-start --name=fll-halt	-- start 90 0 .
	dh_installinit --no-start --name=fll-reboot	-- start 90 6 .

install/fll-live-xorgconfig::
	dh_installinit --no-start --name=fll-xorgconfig	-- start 80 S .

clean::
	# clean up duplicated init script
	rm -f debian/fll-live-initscripts.fll-halt.init
	# clean up xrandr device id lists
	rm -f share/fll-live-xorgconfig/xrandr/*
	# cleanup fll_xserver_discover
	$(MAKE) -C bin clean
	$(MAKE) -C man clean
