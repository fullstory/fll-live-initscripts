#!/usr/bin/make -f

build:
	dh $@
	for i in bin contrib man; do $(MAKE) -C $$i all; done

clean:
	dh $@
	for i in bin contrib man; do $(MAKE) -C $$i $@; done

install: build
	dh $@ --until dh_installinit
	dh_installinit --no-start --name=fll-init       -- start 00 S .
	dh_installinit --no-start --name=fll-locales    -- start 05 S .
	dh_installinit --no-start --name=fll-fstab      -- start 30 S .
	dh_installinit --no-start --name=fll-resume     -- start 30 S .
	dh_installinit --no-start --name=fll-network    -- start 38 S .
	dh_installinit --no-start --name=fll-xorgconfig -- start 80 S .
	dh_installinit --no-start --name=fll-shell      -- start 90 S .
	dh_installinit --no-start --name=fll-adduser    -- start 90 S .
	dh_installinit --no-start --name=fll-xdm        -- start 95 S .
	dh_installinit --no-start --name=fll-desktop    -- start 95 S .
	dh_installinit --no-start --name=fll-hwsetup    -- start 96 S .
	dh_installinit --no-start --name=fll-reboot     -- start 90 0 6 .
	dh $@ --remaining

binary-indep: install
	dh $@

binary-arch: install
	dh $@

binary: initscriptcheck binary-indep binary-arch

initscriptcheck:
	@for init in debian/*.init; do \
		echo "   validating $${init##*/} ..." ; \
		case "`head -n1 $$init`" in \
			*/bin/bash*) \
				bash -n $$init || exit ; \
				;; \
			*) \
				dash -n $$init || exit ; \
				checkbashisms $$init || exit ; \
				;; \
		esac ; \
	done
